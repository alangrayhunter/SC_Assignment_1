---
title: "Practical 4"
format: html
---

# Question 1

```{r}
# Import Packages

# Install dplyr if not already installed
if (!requireNamespace("dplyr", quietly = TRUE)) {
  install.packages("dplyr") 
} 
library(dplyr)

# Install tidyverse if not already installed
if (!requireNamespace("tidyverse", quietly = TRUE)) {
  install.packages("tidyverse")
}
library(tidyverse)

# Install nycflights13 for flight data
if (!requireNamespace("nycflights13", quietly = TRUE)) {
  install.packages("nycflights13")
}
```

```{r}
# load nycflights13  flight data
data(flights, package = "nycflights13") 
flights <- as_tibble(flights)
flights
```

# Question 2



```{r}
# Filter flights by month = 1 (January)
 flights_jan <- flights |> 
   filter(month == 1) |> 
   select(carrier,distance)
```

```{r}
# Group the January flights by carrier
flights_jan_by_carrier <- flights_jan |> 
  group_by(carrier) |> 
  summarise(Mean = mean(distance), SD = sd(distance))
```


#Question 3


```{r}
# Filtering the January Flights to see all flights from the two carriers of interest
flights_jan |> 
  filter(carrier == "OO")
flights_jan |> 
  filter(carrier == "F9")
```

We can see that the carrier 00 has only one distance recorded in January, and that F9 has many, but all of them are equal to 1620.

```{r}
# Make objects containing all the rows of flight distances from each carrier
distance.00 <- flights_jan |> 
  filter(carrier == "OO") |> 
    select(distance)
distance.F9 <- flights_jan |> 
  filter(carrier == "F9") |> 
    select(distance)
```

```{r}
# Find the standard deviation of each of the carriers January flights.
sd.00 <- distance.00 |> 
  summarise(SD = sd(distance))
sd.F9 <-  distance.F9 |> 
  summarise(SD = sd(distance))
sd.00
sd.F9
```

Carrier "00" only has one distance (or row), and so cannot have a standard deviation, hence the standard deviation is "na".

Carrier "F9" has many distances but they are all equal, hence standard deviation is equal to 0.


#Question 4

```{r}
# Flitering Flights for relevant columns
flights_dep_delay <- flights |> 
  select(month,dep_delay,carrier)
```


```{r}
# Averages per carrier per month
flights_dep_delay_averages <- flights_dep_delay |> 
  group_by(month,carrier) |> 
  summarise(avg_dep_delay = mean(dep_delay,na.rm = TRUE))
flights_dep_delay_averages
```


```{r}
# Dataframe transformed from long to wide
flights_dep_delay_wide <- flights_dep_delay_averages |> 
  pivot_wider(
    names_from = carrier,
    values_from = avg_dep_delay
  )
flights_dep_delay_wide
```

#Question 5
```{r}
flights_arrival_times <- flights |> 
  select(dep_delay,arr_delay) |> 
  filter(dep_delay > 0)|>
  filter(arr_delay <= 0)
flights_arrival_times
```


```{r}
prop_late_but_on_time <- flights |>
  summarise(
    proportion = mean(dep_delay > 0 & arr_delay <= 0, na.rm = TRUE)
  )

prop_late_but_on_time
```
The proportion of flights out of the total flights that were delayed but still arrived on time is 0.1081096 or approximately 11%.

# Question 6



```{r}
# load nycflights13 airlines data
data(airlines, package = "nycflights13") 
airlines <- as_tibble(airlines)
airlines
```

## 6.1

```{r}
flights_routes <- flights |> 
  select(origin,dest,carrier) |>
  distinct() |> 
  group_by(origin,dest)
flights_routes
```

```{r}
flight_routes_multiple_airlines <- flights_routes |> 
  count(origin,dest,name = "number_of_airlines") |> 
  filter(number_of_airlines>1)
flight_routes_multiple_airlines
```


## 6.2

```{r}
flights_multiple_airlines <- flights |>
  select(origin,dest,carrier,arr_delay) |>
  group_by(origin,dest,carrier) |> 
  semi_join(flight_routes_multiple_airlines,join_by(origin == origin, dest == dest))
flights_multiple_airlines
```


```{r}
average_delay <- flights_multiple_airlines |> 
  summarise(mean_delay = mean(arr_delay,na.rm=TRUE))
average_delay
```


```{r}
average_delay_with_airline_name <- average_delay |> 
  left_join(airlines, by = join_by(carrier))
average_delay_with_airline_name
```

## 6.3


```{r}
max_delay <- average_delay_with_airline_name |> 
  group_by(origin,dest) |> 
  slice_max(mean_delay)
max_delay
```

```{r}
min_delay <- average_delay_with_airline_name |> 
  group_by(origin,dest) |> 
  slice_min(mean_delay)
min_delay
```

```{r}
max_and_min_delays <- max_delay |> 
  left_join(min_delay,by = join_by(origin, dest)) |> 
  rename(max_carrier = carrier.x,
         max_mean_delay = mean_delay.x,
         max_name=name.x,
         min_carrier = carrier.y,
         min_mean_delay = mean_delay.y,
         min_name = name.y)
max_and_min_delays
```

## 6.4

```{r}
differences <- max_and_min_delays |> 
  mutate(difference = max_mean_delay - min_mean_delay) |> 
  ungroup()
differences
```
```{r}
greatest_diff <- differences |> 
  slice_max(difference)
greatest_diff
```


## 6.5

```{r}
max_diff_flights <- flights |> 
  filter(origin == "JFK", dest == "ATL", carrier == "EV")
max_diff_flights
```
```{r}
min_diff_flights <- flights |> 
  filter(origin == "JFK", dest == "ATL", carrier == "9E")
min_diff_flights
```

```{r}
hist(max_diff_flights$arr_delay)
hist(min_diff_flights$arr_delay)
```

The difference arises due to the following. Firstly, on the JFK to ATL route, the airline 9E or Endeavor Air Inc, has many flights along this route with delays that appear to be normally distributed with a mean around 0, which can be seen in the "Histogram of min_diff
_flights$arr_delay" plot above. On the other hand, the airline EV or ExpressJet Airlines only has one flight along the same route. In addition, that single ExpressJet Airlines flight had a very high arr_delay of 128, much higher than the maximum Endeavor Air delay of 55.

Having only a single flight results in a very high risk of an outlier skewing the results. In this case, 9E has a good average delay time, and due to EV's one flight being so delayed, the difference between their averages is the biggest.

# Question 7

```{r}
data <- structure(list(id = c("id_1", "id_2", "id_3", "id_4", "id_5", 
"id_6", "id_7", "id_8", "id_9", "id_10", "id_11", "id_12", "id_13", 
"id_14", "id_15", "id_16", "id_17", "id_18", "id_19", "id_20", 
"id_21", "id_22", "id_23", "id_24", "id_25", "id_26", "id_27", 
"id_28", "id_29", "id_30", "id_31", "id_32", "id_33", "id_34", 
"id_35", "id_36", "id_37", "id_38", "id_39", "id_40", "id_41", 
"id_42", "id_43", "id_44", "id_45", "id_46", "id_47", "id_48", 
"id_49", "id_50"), age = c(50L, 34L, 70L, 33L, 22L, 61L, 69L, 
73L, 62L, 56L, 71L, 33L, 73L, 44L, 45L, 46L, 24L, 70L, 46L, 76L, 
47L, 76L, 28L, 48L, 54L, 27L, 45L, 26L, 61L, 28L, 38L, 55L, 33L, 
36L, 62L, 58L, 72L, 31L, 34L, 51L, 61L, 64L, 26L, 28L, 60L, 29L, 
42L, 46L, 79L, 72L), gender = c("male", "male", "male", "female", 
"female", "male", "female", "male", "male", "female", "female", 
"male", "male", "female", "male", "male", "male", "male", "female", 
"male", "male", "male", "male", "female", "femal", "male", "female", 
"female", "female", "female", "male", "female", "female", "female", 
"male", "male", "female", "male", "female", "female", "male", 
"female", "female", "male", "male", "female", "male", "male", 
"male", "female"), height = c(174.4, 197.7, 174.1, 194.5, NA, 
180.4, 170.5, 157.4, 196.8, 165.1, 153, 197.4, 186, 157.1, 177.5, 
197.7, 179.3, 170.2, 182.4, NA, 165.4, 161, 168.5, 199.2, 157.7, 
154.6, 157.1, 184.5, 181, 194.6, 183.6, 186.9, 176.1, 183, 191.1, 
189.3, 199, 172, 165.6, 170.5, 150.5, 159.2, 192.1, 161.6, 162, 
153.8, 162.3, 186.6, 192.4, 174.9), weight = c(69.4, 62.3, 55.6, 
69.5, 78.6, 60.8, 72.2, 60.9, 75.1, 67.7, 82.5, 68.7, 67.8, 76.7, 
87, 61.1, 70.6, 63.3, 81.5, 59.2, 93.2, 87.3, 83.4, 80.9, 68.6, 
76.5, 93.7, 79.1, 92, 65.6, 85.4, 63.3, 79.7, 74.1, 63.3, 78.2, 
95.7, 95.1, 63.7, 66.1, 99.3, 81, 96.9, 73.3, 70.3, 83, 57.6, 
78.6, 61.9, 98.1), blood_type = c("O", "A", "O", "O", "B", "AB", 
"O", "O", "O", "AB", "A", "O", "O", "O", "B", "A", "B", "AB", 
"O", "AB", "A", "AB", "O", "B", "A", "A", "B", "AB", "A", "B", 
"B", "A", "O", "O", "O", "B", "O", "A", "A", "B", "A", "O", "AB", 
"A", "A", "O", "O", "B", "A", "O"), disease_status = c("diseased", 
"healthy", "healthy", "healthy", "healthy", "healthy", "diseased", 
"healthy", "diseased", "Healthy", "diseased", "healthy", "diseased", 
"healthy", "diseased", "healthy", "healthy", "healthy", "healthy", 
"healthy", "healthy", "diseased", "healthy", "diseased", "healthy", 
"healthy", "healthy", "healthy", "diseased", "diseased", "healthy", 
"healthy", "healthy", "diseased", "diseased", "diseased", "healthy", 
"diseased", "healthy", "healthy", "healthy", "healthy", "healthy", 
"diseased", "diseased", "diseased", "healthy", "healthy", "diseased", 
"diseased"), cholesterol = c(228, 223, 213, 198, 166, 151, 195, 
199, 189, 196, 221, 156, 185, 230, 234, 174, 185, 236, 235, 180, 
165, 220, 160, 153, 250, 153, 184, 242, 212, 179, 224, 233, 181, 
199, 220, 214, 214, 248, 191, 162, 203, 173, 199, 187, 248, 189, 
173, 212, 164, 247), glucose = c(96, 78, 101, 119, 103, 91, 86, 
NA, 77, 80, 115, 85, 88, 109, NA, 71, 90, 94, 91, 87, 113, 93, 
97, 118, 109, 80, 85, 119, 99, 108, 89, 108, 97, 116, 79, 84, 
75, 81, 119, NA, 106, 109, 75, 82, 84, 75, 76, 120, 119, 77), 
    smoker = c("yes", "yes", "yes", "yes", "no", "yes", "no", 
    "yes", "no", "no", "no", "no", "no", "yes", "no", "yes", 
    "yes", "yes", "yes", "yes", "yes", "yes", "yes", "yes", "no", 
    "no", "yes", "yes", "yes", "no", "no", "yes", "no", "yes", 
    "no", "yes", "no", "yes", "yes", "yes", "no", "no", "yes", 
    "no", "no", "no", "no", "no", "no", "yes"), exercise = c("occasional", 
    "regular", "occasional", "regular", "none", "occasional", 
    "regular", "none", "occasional", "none", "occasional", "none", 
    "none", "regular", "occasional", "none", "regular", "regular", 
    "none", "occasional", "none", "occasional", "occasional", 
    "occasional", "regular", "occasional", "regular", "regular", 
    "regular", "occasional", "occasional", "none", "none", "regular", 
    "occasional", "occasional", "none", "none", "none", "none", 
    "occasional", "regular", "regular", "none", "regular", "occasional", 
    "occasional", "none", "occasional", "regular"), income = c(84820L, 
    81547L, 22588L, 72490L, 74533L, 25338L, 41469L, 57315L, 63629L, 
    88662L, 62615L, 56261L, 58499L, 82232L, 77584L, 77275L, 38468L, 
    54510L, 91326L, 78611L, 31402L, 29586L, 21441L, 58269L, 84173L, 
    88295L, 37940L, 43750L, 69750L, 92356L, 82518L, 91455L, 68866L, 
    51178L, 68275L, 27689L, 35418L, 81318L, 62405L, 86851L, 25654L, 
    47553L, 74474L, 51409L, 22607L, 55360L, 96351L, 21516L, 41927L, 
    55810L), education = c("master", "bachelor", "PhD", "master", 
    "bachelor", "highschool", "PhD", "highschool", "PhD", "PhD", 
    "bachelor", "highschool", "master", "bachelor", "PhD", "PhD", 
    "PhD", "bachelor", "master", "highschool", "PhD", "highschool", 
    "bachelor", "master", "highschool", "highschool", "master", 
    "master", "bachelor", "PhD", "highschool", "PhD", "master", 
    "master", "master", "PhD", "highschool", "master", "master", 
    "highschool", "bachelor", "highschool", "bachelor", "PhD", 
    "bachelor", "highschool", "master", "highschool", "bachelor", 
    "bachelor"), region = c("North", "South", "North", "West", 
    "North", "West", "South", "South", "West", "South", "West", 
    "South", "West", "East", "North", "West", "North", "North", 
    "West", "North", "East", "West", "South", "North", "North", 
    "East", "East", "North", "North", "West", "South", "West", 
    "West", "East", "West", "North", "West", "North", "East", 
    "North", "West", "South", "South", "East", "North", "West", 
    "West", "East", "North", "East"), marital_status = c("divorced", 
    "single", "divorced", "divorced", "divorced", "divorced", 
    "divorced", "married", "divorced", "married", "divorced", 
    "widowed", "married", "single", "widowed", "widowed", "single", 
    "divorced", "widowed", "widowed", "single", "married", "single", 
    "married", "widowed", "married", "single", "single", "widowed", 
    "married", "widowed", "divorced", "single", "married", "single", 
    "widowed", "widowed", "married", "widowed", "divorced", "married", 
    "married", "divorced", "single", "married", "widowed", "divorced", 
    "divorced", "single", "divorced")), row.names = c(NA, -50L
), class = c("tbl_df", "tbl", "data.frame"))
```

```{r}
data
```

```{r}
if (!requireNamespace("remotes", quietly = TRUE)) {
  install.packages("remotes")
}
remotes::install_github("SATVILab/UtilsDataRSV")
```

```{r}
UtilsDataRSV::view_cols(data)
```

From the above we can see that the columns that contain missinging values include columns "height and "glucose".

The column "gender" has one entry has a typo, as it says "femal" instead of "female". Additonaly, the "disease_status" column has one entry that has "Healthy" with a capital "H" whilst the other entries are "healthy" with a lowercase "h".

The "id" column values all include the text "id_" which results in the column being formatted as "character" and not as "integer". If you were to sort the data by the ID column the rows are not in the order you'd expect. As illustrated below, you can see the first row is "id_1" but then it jumps to "id_10" instead of "id_2".

```{r}
class(data$id)
data |> arrange(id)
```

